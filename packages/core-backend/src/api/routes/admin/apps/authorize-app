import { IsNotEmpty, IsString } from "class-validator"

import { OAuthService } from "../../../../services"
import { validator } from "../../../../utils/validator"

export default async (req, res) => {
  const validated = await validator(PostAppsReq, req.body)
  const oauthService: OAuthService = req.scope.resolve("oauthService")
  const data = await oauthService.generateToken(
    validated.identifer,
    validated.code,
    validated.state
  )
  res.status(200).json({ apps: data })
}

export class PostAppsReq {
  @IsString()
  @IsNotEmpty()
  identifer: string

  @IsString()
  @IsNotEmpty()
  state: string

  @IsString()
  @IsNotEmpty()
  code: string
}